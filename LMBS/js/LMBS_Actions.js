// Generated by RPG Maker.
// Do not edit this file directly.
var $plugins =
[
  {"name":"LMBS＿Motion","status":true,"description":"","parameters":{}}
];

//=============================================================================
// LMBS_Action
//-----------------------------------------------------------------------------
//
//=============================================================================
function LMBS_Action() { this.initialize.apply(this, arguments); }
LMBS_Action.prototype.constructor = LMBS_Action;

/**
 * constructor
 */
LMBS_Action.prototype.initialize = function(name) {
    this.name = name;
    this.battler = null;
    this.frameCount = 0;
}

/**
 */
LMBS_Action.prototype.onAttached = function() {
}

/**
 */
LMBS_Action.prototype.onUserInput = function() {
}

/**
 */
LMBS_Action.prototype.onUpdate = function() {
    this.frameCount++;
}

//=============================================================================
/**
 * アイドリング（待機）アクション
 * @class LMBS_IdleAction
 * @constructor
 */
function LMBS_IdleAction() { this.initialize.apply(this, arguments); }
LMBS_IdleAction.prototype = Object.create(LMBS_Action.prototype);
LMBS_IdleAction.prototype.constructor = LMBS_IdleAction;

/**
 * constructor
 */
LMBS_IdleAction.prototype.initialize = function(name) {
    LMBS_Action.prototype.initialize.call(this, name);
}

/**
 *  override
 */
LMBS_IdleAction.prototype.onAttached = function() {
    LMBS_Action.prototype.onUpdate.call(this);
    // モーション開始
    this.battler.changeMotion("basic_wait");
}

/**
 */
LMBS_IdleAction.prototype.onUserInput = function() {
    LMBS_Action.prototype.onUserInput.call(this);
    if (Input.dir4 == 4) {
        this.battler.direction = LMBS_Battler.DIRECTION.LEFT;
        this.battler.changeAction(new LMBS_WalkAction());
    }
    else if (Input.dir4 == 6) {
        this.battler.direction = LMBS_Battler.DIRECTION.RIGHT;
        this.battler.changeAction(new LMBS_WalkAction());
    }

    // ターゲットに向く
    var target = this.battler.getActionTargetBattlerObject();
    if (target != null) {
        var d = target.position.x - this.battler.position.x;
        this.battler.direction = d / Math.abs(d); // 正規化。1Dなのでこれでいい。
    }
}

/**
 *  override
 */
LMBS_IdleAction.prototype.onUpdate = function() {
    LMBS_Action.prototype.onUpdate.call(this);
}

//=============================================================================
/**
 * 歩行アクション
 * @class LMBS_WalkAction
 * @constructor
 */
function LMBS_WalkAction() { this.initialize.apply(this, arguments); }
LMBS_WalkAction.prototype = Object.create(LMBS_Action.prototype);
LMBS_WalkAction.prototype.constructor = LMBS_WalkAction;

/**
 * constructor
 */
LMBS_WalkAction.prototype.initialize = function(name) {
    LMBS_Action.prototype.initialize.call(this, name);
}

/**
 *  override
 */
LMBS_WalkAction.prototype.onAttached = function() {
    LMBS_Action.prototype.onUpdate.call(this);
    // モーション開始
    this.battler.changeMotion("basic_move");

    // test
    var animation = $dataAnimations[2];
    //var mirror = data.mirror;
    //var delay = animation.position === 3 ? 0 : data.delay;
    this.battler._visual.mainSprite.startAnimation(animation, false, 0);
}

/**
 *  override
 */
LMBS_WalkAction.prototype.onUserInput = function() {
    LMBS_Action.prototype.onUserInput.call(this);
    var vel = this.battler.direction;
    if (Input.isPressed('left')) {
        this.battler.mainBody.applyMovement(-vel, 0);
    }
    else if (Input.isPressed('right')) {
        this.battler.mainBody.applyMovement(vel, 0);
    }
    else {
        // キーが押されていなければ Idle 状態へ
        this.battler.changeAction(new LMBS_IdleAction());
    }
}

/**
 *  override
 */
LMBS_WalkAction.prototype.onUpdate = function() {
    LMBS_Action.prototype.onUpdate.call(this);

}
